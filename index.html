<!DOCTYPE html>
<html>
<head>
    <title>Pomato Puzzle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #e6f7e6;
            padding: 20px;
            margin: 0;
        }
        h1 {
            color: #8b4513;
            margin: 10px 0;
        }
        #header-image {
            max-width: 200px;
            border-radius: 10px;
            border: 3px solid #8b4513;
            margin: 0 auto;
            display: block;
        }
        #difficulty {
            margin: 15px 0;
        }
        #puzzle-container {
            margin: 0 auto;
            position: relative;
            border: 3px solid #8b4513;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            background: #fff;
        }
        .puzzle-tile {
            position: absolute;
            background-size: cover;
            border: 1px solid #ddd;
            transition: all 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(0,0,0,0.5);
            font-weight: bold;
        }
        .puzzle-tile:hover {
            transform: scale(1.02);
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        #controls {
            margin: 15px 0;
        }
        button {
            background: #8b4513;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #a0522d;
        }
        #moves, #win-message {
            font-size: 18px;
            margin: 10px;
            font-weight: bold;
        }
        #win-message {
            color: #8b4513;
            min-height: 24px;
        }
        @media (max-width: 500px) {
            #puzzle-container {
                width: 90vw;
                height: 90vw;
            }
        }
    </style>
</head>
<body>
    <img id="header-image" src="Poisonous-pomato-berry.jpg" alt="Poisonous Pomato Berry">
    <h1>Pomato Puzzle</h1>
    
    <div id="difficulty">
        <button id="easy-btn">Easy (3×3)</button>
        <button id="medium-btn">Medium (4×4)</button>
        <button id="hard-btn">Hard (5×5)</button>
    </div>
    
    <div id="moves">Moves: 0</div>
    <div id="win-message"></div>
    
    <div id="puzzle-container"></div>
    
    <div id="controls">
        <button id="shuffle-btn">Shuffle</button>
    </div>

    <script>
        // Game variables
        const puzzleContainer = document.getElementById('puzzle-container');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const movesDisplay = document.getElementById('moves');
        const winMessage = document.getElementById('win-message');
        const easyBtn = document.getElementById('easy-btn');
        const mediumBtn = document.getElementById('medium-btn');
        const hardBtn = document.getElementById('hard-btn');
        
        let size = 4; // Default medium (4×4)
        let tiles = [];
        let emptyPos = {row: size-1, col: size-1};
        let moves = 0;
        let gameStarted = false;
        const imageUrl = 'poisonous-pomato-berry.jpg';
        
        // Initialize the game
        function initGame() {
            puzzleContainer.innerHTML = '';
            puzzleContainer.style.width = `${size * 100}px`;
            puzzleContainer.style.height = `${size * 100}px`;
            
            tiles = [];
            moves = 0;
            movesDisplay.textContent = 'Moves: 0';
            winMessage.textContent = '';
            gameStarted = false;
            emptyPos = {row: size-1, col: size-1};
            
            // Create tiles
            for (let row = 0; row < size; row++) {
                for (let col = 0; col < size; col++) {
                    // Skip the bottom-right tile (empty space)
                    if (row === size-1 && col === size-1) continue;
                    
                    const tile = document.createElement('div');
                    tile.className = 'puzzle-tile';
                    tile.style.width = `${100/size}%`;
                    tile.style.height = `${100/size}%`;
                    tile.style.backgroundImage = `url(${imageUrl})`;
                    tile.style.backgroundPosition = `-${col * (100/size)}% -${row * (100/size)}%`;
                    tile.dataset.row = row;
                    tile.dataset.col = col;
                    tile.dataset.correctRow = row;
                    tile.dataset.correctCol = col;
                    
                    if (size <= 4) {
                        tile.textContent = (row * size + col + 1).toString();
                    }
                    
                    tile.addEventListener('click', () => moveTile(tile));
                    
                    puzzleContainer.appendChild(tile);
                    tiles.push(tile);
                    
                    // Position the tile
                    updateTilePosition(tile, row, col);
                }
            }
        }
        
        // Update tile position on screen
        function updateTilePosition(tile, row, col) {
            tile.style.left = `${col * (100/size)}%`;
            tile.style.top = `${row * (100/size)}%`;
            tile.dataset.row = row;
            tile.dataset.col = col;
        }
        
        // Move a tile if possible
        function moveTile(tile) {
            const row = parseInt(tile.dataset.row);
            const col = parseInt(tile.dataset.col);
            
            // Check if tile is adjacent to empty space
            if ((Math.abs(row - emptyPos.row) === 1 && col === emptyPos.col) ||
                (Math.abs(col - emptyPos.col) === 1 && row === emptyPos.row)) {
                
                if (!gameStarted) gameStarted = true;
                
                // Swap positions
                updateTilePosition(tile, emptyPos.row, emptyPos.col);
                emptyPos = {row: row, col: col};
                
                // Update moves
                moves++;
                movesDisplay.textContent = `Moves: ${moves}`;
                
                // Check if puzzle is solved
                if (checkWin()) {
                    winMessage.textContent = `You won in ${moves} moves!`;
                }
            }
        }
        
        // Check if puzzle is solved
        function checkWin() {
            for (const tile of tiles) {
                if (parseInt(tile.dataset.row) !== parseInt(tile.dataset.correctRow) || 
                    parseInt(tile.dataset.col) !== parseInt(tile.dataset.correctCol)) {
                    return false;
                }
            }
            return true;
        }
        
        // Shuffle the tiles
        function shuffleTiles() {
            if (gameStarted) return;
            
            const totalTiles = size * size - 1;
            const positions = [];
            for (let i = 0; i < totalTiles; i++) {
                positions.push(i);
            }
            
            // Fisher-Yates shuffle
            for (let i = positions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [positions[i], positions[j]] = [positions[j], positions[i]];
            }
            
            emptyPos = {row: size-1, col: size-1};
            let index = 0;
            
            for (let row = 0; row < size; row++) {
                for (let col = 0; col < size; col++) {
                    if (row === size-1 && col === size-1) continue;
                    
                    const pos = positions[index];
                    const tileRow = Math.floor(pos / size);
                    const tileCol = pos % size;
                    
                    updateTilePosition(tiles[index], tileRow, tileCol);
                    index++;
                }
            }
            
            // Ensure the puzzle is solvable
            if (!isSolvable(positions)) {
                [positions[0], positions[1]] = [positions[1], positions[0]];
                shuffleTiles();
            }
        }
        
        // Check if the puzzle is solvable
        function isSolvable(positions) {
            let inversions = 0;
            for (let i = 0; i < positions.length; i++) {
                for (let j = i + 1; j < positions.length; j++) {
                    if (positions[i] > positions[j]) inversions++;
                }
            }
            
            if (size % 2 === 1) return inversions % 2 === 0;
            return (inversions + emptyPos.row) % 2 === 1;
        }
        
        // Event listeners
        shuffleBtn.addEventListener('click', shuffleTiles);
        easyBtn.addEventListener('click', () => { size = 3; initGame(); });
        mediumBtn.addEventListener('click', () => { size = 4; initGame(); });
        hardBtn.addEventListener('click', () => { size = 5; initGame(); });
        
        // Start the game
        initGame();
    </script>
</body>
</html>
